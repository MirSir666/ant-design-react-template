{"ast":null,"code":"import _defineProperty from\"/workspace/lightence-ant-design-react-template/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";import _toConsumableArray from\"/workspace/lightence-ant-design-react-template/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _objectSpread from\"/workspace/lightence-ant-design-react-template/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _slicedToArray from\"/workspace/lightence-ant-design-react-template/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useState,useEffect,useCallback,useMemo}from'react';import{useTranslation}from'react-i18next';import{Tag}from'@app/components/common/Tag/Tag';import{AuthorValidator,TitleValidator,DatesValidator,TagsValidator}from'../Validator';import{useResponsive}from'@app/hooks/useResponsive';import{newsTags as defaultTags}from'@app/constants/newsTags';import{Dates}from'@app/constants/Dates';import*as S from'./NewsFilter.styles';import{Dropdown}from'@app/components/common/Dropdown/Dropdown';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var Filter=function Filter(_ref){var author=_ref.author,title=_ref.title,newsTagData=_ref.newsTagData,onTagClick=_ref.onTagClick,selectedTagsIds=_ref.selectedTagsIds,selectedTags=_ref.selectedTags,dates=_ref.dates,onApply=_ref.onApply,onReset=_ref.onReset,updateFilteredField=_ref.updateFilteredField;var _useTranslation=useTranslation(),t=_useTranslation.t;var _useResponsive=useResponsive(),mobileOnly=_useResponsive.mobileOnly;var applyFilter=function applyFilter(){onApply();};var resetFilter=function resetFilter(){onReset();};return/*#__PURE__*/_jsxs(S.FilterWrapper,{children:[!mobileOnly&&/*#__PURE__*/_jsx(S.FilterTitle,{children:t('newsFeed.filter')}),/*#__PURE__*/_jsxs(S.InputWrapper,{children:[/*#__PURE__*/_jsx(S.SearchIcon,{}),/*#__PURE__*/_jsx(S.Input,{placeholder:t('newsFeed.authorSearch'),value:author,onChange:function onChange(event){return updateFilteredField('author',event.target.value);}})]}),/*#__PURE__*/_jsxs(S.InputWrapper,{children:[/*#__PURE__*/_jsx(S.SearchIcon,{}),/*#__PURE__*/_jsx(S.Input,{placeholder:t('newsFeed.titleSearch'),value:title,onChange:function onChange(event){return updateFilteredField('title',event.target.value);}})]}),/*#__PURE__*/_jsx(Dropdown,{placement:\"bottomCenter\",trigger:['click'],overlay:/*#__PURE__*/_jsxs(S.TagPopover,{children:[newsTagData.map(function(tag){return/*#__PURE__*/_jsxs(S.TagPopoverLine,{onClick:function onClick(e){onTagClick(tag);e.stopPropagation();},children:[/*#__PURE__*/_jsx(S.PopoverCheckbox,{checked:selectedTagsIds.includes(tag.id)}),/*#__PURE__*/_jsx(Tag,{title:tag.title,bgColor:tag.bgColor})]},tag.id);}),/*#__PURE__*/_jsx(S.ClosePopoverWrapper,{children:/*#__PURE__*/_jsx(S.ClosePopover,{})})]}),children:/*#__PURE__*/_jsxs(S.AddTagWrapper,{children:[/*#__PURE__*/_jsx(S.PlusIcon,{}),/*#__PURE__*/_jsx(S.AddTagText,{children:t('newsFeed.tag')})]})}),!!selectedTags.length&&/*#__PURE__*/_jsx(S.TagsWrapper,{children:selectedTags.map(function(tag){return/*#__PURE__*/_jsx(Tag,{title:tag.title,bgColor:tag.bgColor,removeTag:function removeTag(){return onTagClick(tag);}},tag.id);})}),/*#__PURE__*/_jsxs(S.DateLabels,{children:[/*#__PURE__*/_jsx(S.DateLabel,{children:t('newsFeed.from')}),/*#__PURE__*/_jsx(S.DateLabel,{children:t('newsFeed.to')})]}),/*#__PURE__*/_jsx(S.RangePicker,{dropdownClassName:\"range-picker\",value:dates,onChange:function onChange(dates){return updateFilteredField('dates',[dates!==null&&dates!==void 0&&dates.length?dates[0]:null,dates!==null&&dates!==void 0&&dates.length?dates[1]:null]);}}),/*#__PURE__*/_jsxs(S.BtnWrapper,{children:[/*#__PURE__*/_jsx(S.Btn,{onClick:function onClick(){return resetFilter();},children:t('newsFeed.reset')}),/*#__PURE__*/_jsx(S.Btn,{onClick:function onClick(){return applyFilter();},type:\"primary\",children:t('newsFeed.apply')})]})]});};export var NewsFilter=function NewsFilter(_ref2){var news=_ref2.news,newsTags=_ref2.newsTags,children=_ref2.children;var _useState=useState({author:'',title:'',selectedTags:[],dates:[null,null]}),_useState2=_slicedToArray(_useState,2),filterFields=_useState2[0],setFilterFields=_useState2[1];var author=filterFields.author,title=filterFields.title,selectedTags=filterFields.selectedTags,dates=filterFields.dates;var _useState3=useState(news),_useState4=_slicedToArray(_useState3,2),filteredNews=_useState4[0],setFilteredNews=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),overlayVisible=_useState6[0],setOverlayVisible=_useState6[1];var _useResponsive2=useResponsive(),mobileOnly=_useResponsive2.mobileOnly;var _useTranslation2=useTranslation(),t=_useTranslation2.t;var newsTagData=Object.values(newsTags||defaultTags);var selectedTagsIds=useMemo(function(){return selectedTags.map(function(item){return item.id;});},[selectedTags]);var onTagClick=useCallback(function(tag){var isExist=selectedTagsIds.includes(tag.id);if(isExist){setFilterFields(_objectSpread(_objectSpread({},filterFields),{},{selectedTags:selectedTags.filter(function(item){return item.id!==tag.id;})}));}else{setFilterFields(_objectSpread(_objectSpread({},filterFields),{},{selectedTags:[].concat(_toConsumableArray(selectedTags),[tag])}));}},[selectedTags,selectedTagsIds,filterFields]);var filterNews=useCallback(function(){var isReset=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var updatedNews=_toConsumableArray(news);if((author||title||dates[0]||selectedTags.length)&&!isReset){updatedNews=news.filter(function(post){var postAuthor=post.author.toLowerCase();var enteredAuthor=author.toLowerCase();var postTitle=post.title.toLowerCase();var enteredTitle=title.toLowerCase();var postTags=post.tags;var postDate=Dates.getDate(post.date);var fieldsValidators=[new AuthorValidator(postAuthor,enteredAuthor),new TitleValidator(postTitle,enteredTitle),new DatesValidator(postDate,dates),new TagsValidator(postTags,selectedTags)];return fieldsValidators.map(function(validator){return validator.validate();}).every(function(i){return i;});});}setFilteredNews(updatedNews.sort(function(a,b){return b.date-a.date;}));},[news,author,title,dates,selectedTags]);useEffect(function(){setFilteredNews(news);filterNews(false);// TODO AT-183\n// eslint-disable-next-line\n},[news]);var handleClickApply=useCallback(function(){filterNews(false);if(mobileOnly){setOverlayVisible(false);}},[mobileOnly,filterNews]);var handleClickReset=useCallback(function(){setFilterFields({author:'',title:'',dates:[null,null],selectedTags:[]});filterNews(true);if(mobileOnly){setOverlayVisible(false);}},[filterNews,setFilterFields,mobileOnly]);var updateFilteredField=function updateFilteredField(field,value){setFilterFields(_objectSpread(_objectSpread({},filterFields),{},_defineProperty({},field,value)));};return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(S.TitleWrapper,{children:mobileOnly&&/*#__PURE__*/_jsx(Dropdown,{placement:\"bottomLeft\",trigger:['click'],visible:overlayVisible,onVisibleChange:function onVisibleChange(visible){return setOverlayVisible(visible);},overlay:/*#__PURE__*/_jsx(Filter,{author:author,title:title,newsTagData:newsTagData,onTagClick:onTagClick,selectedTagsIds:selectedTagsIds,selectedTags:selectedTags,dates:dates,onApply:handleClickApply,onReset:handleClickReset,updateFilteredField:updateFilteredField}),children:/*#__PURE__*/_jsx(S.FilterButton,{children:t('newsFeed.filter')})})}),/*#__PURE__*/_jsxs(S.ContentWrapper,{children:[/*#__PURE__*/_jsx(S.NewsWrapper,{children:children({filteredNews:filteredNews||news})}),!mobileOnly&&/*#__PURE__*/_jsx(Filter,{author:author,title:title,newsTagData:newsTagData,onTagClick:onTagClick,selectedTagsIds:selectedTagsIds,selectedTags:selectedTags,dates:dates,onApply:handleClickApply,onReset:handleClickReset,updateFilteredField:updateFilteredField})]})]});};","map":{"version":3,"sources":["/workspace/lightence-ant-design-react-template/src/components/apps/newsFeed/NewsFilter/NewsFilter.tsx"],"names":["React","useState","useEffect","useCallback","useMemo","useTranslation","Tag","AuthorValidator","TitleValidator","DatesValidator","TagsValidator","useResponsive","newsTags","defaultTags","Dates","S","Dropdown","Filter","author","title","newsTagData","onTagClick","selectedTagsIds","selectedTags","dates","onApply","onReset","updateFilteredField","t","mobileOnly","applyFilter","resetFilter","event","target","value","map","tag","e","stopPropagation","includes","id","bgColor","length","NewsFilter","news","children","filterFields","setFilterFields","filteredNews","setFilteredNews","overlayVisible","setOverlayVisible","Object","values","item","isExist","filter","filterNews","isReset","updatedNews","post","postAuthor","toLowerCase","enteredAuthor","postTitle","enteredTitle","postTags","tags","postDate","getDate","date","fieldsValidators","validator","validate","every","i","sort","a","b","handleClickApply","handleClickReset","field","visible"],"mappings":"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","sourcesContent":["import React, { ReactNode, useState, useEffect, useCallback, useMemo } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { RangeValue } from 'rc-picker/lib/interface.d';\nimport { Tag, ITag } from '@app/components/common/Tag/Tag';\nimport { AuthorValidator, TitleValidator, DatesValidator, TagsValidator } from '../Validator';\nimport { useResponsive } from '@app/hooks/useResponsive';\nimport { newsTags as defaultTags } from '@app/constants/newsTags';\nimport { AppDate, Dates } from '@app/constants/Dates';\nimport { Post } from '@app/api/news.api';\nimport * as S from './NewsFilter.styles';\nimport { Dropdown } from '@app/components/common/Dropdown/Dropdown';\n\ninterface NewsFilterProps {\n  news: Post[];\n  newsTags?: ITag[];\n  children: ({ filteredNews }: { filteredNews: Post[] }) => ReactNode;\n}\n\ninterface Filter {\n  author: string;\n  title: string;\n  newsTagData: ITag[];\n  onTagClick: (tag: ITag) => void;\n  selectedTagsIds: Array<string>;\n  selectedTags: ITag[];\n  dates: [AppDate | null, AppDate | null];\n  updateFilteredField: (field: string, value: [AppDate | null, AppDate | null] | string) => void;\n  onApply: () => void;\n  onReset: () => void;\n}\n\nconst Filter: React.FC<Filter> = ({\n  author,\n  title,\n  newsTagData,\n  onTagClick,\n  selectedTagsIds,\n  selectedTags,\n  dates,\n  onApply,\n  onReset,\n  updateFilteredField,\n}) => {\n  const { t } = useTranslation();\n  const { mobileOnly } = useResponsive();\n\n  const applyFilter = () => {\n    onApply();\n  };\n\n  const resetFilter = () => {\n    onReset();\n  };\n\n  return (\n    <S.FilterWrapper>\n      {!mobileOnly && <S.FilterTitle>{t('newsFeed.filter')}</S.FilterTitle>}\n\n      <S.InputWrapper>\n        <S.SearchIcon />\n        <S.Input\n          placeholder={t('newsFeed.authorSearch')}\n          value={author}\n          onChange={(event) => updateFilteredField('author', event.target.value)}\n        />\n      </S.InputWrapper>\n\n      <S.InputWrapper>\n        <S.SearchIcon />\n        <S.Input\n          placeholder={t('newsFeed.titleSearch')}\n          value={title}\n          onChange={(event) => updateFilteredField('title', event.target.value)}\n        />\n      </S.InputWrapper>\n\n      <Dropdown\n        placement=\"bottomCenter\"\n        trigger={['click']}\n        overlay={\n          <S.TagPopover>\n            {newsTagData.map((tag: ITag) => (\n              <S.TagPopoverLine\n                key={tag.id}\n                onClick={(e) => {\n                  onTagClick(tag);\n                  e.stopPropagation();\n                }}\n              >\n                <S.PopoverCheckbox checked={selectedTagsIds.includes(tag.id)} />\n                <Tag title={tag.title} bgColor={tag.bgColor} />\n              </S.TagPopoverLine>\n            ))}\n            <S.ClosePopoverWrapper>\n              <S.ClosePopover />\n            </S.ClosePopoverWrapper>\n          </S.TagPopover>\n        }\n      >\n        <S.AddTagWrapper>\n          <S.PlusIcon />\n          <S.AddTagText>{t('newsFeed.tag')}</S.AddTagText>\n        </S.AddTagWrapper>\n      </Dropdown>\n\n      {!!selectedTags.length && (\n        <S.TagsWrapper>\n          {selectedTags.map((tag) => (\n            <Tag key={tag.id} title={tag.title} bgColor={tag.bgColor} removeTag={() => onTagClick(tag)} />\n          ))}\n        </S.TagsWrapper>\n      )}\n\n      <S.DateLabels>\n        <S.DateLabel>{t('newsFeed.from')}</S.DateLabel>\n        <S.DateLabel>{t('newsFeed.to')}</S.DateLabel>\n      </S.DateLabels>\n\n      <S.RangePicker\n        dropdownClassName=\"range-picker\"\n        value={dates}\n        onChange={(dates: RangeValue<AppDate>) =>\n          updateFilteredField('dates', [dates?.length ? dates[0] : null, dates?.length ? dates[1] : null])\n        }\n      />\n\n      <S.BtnWrapper>\n        <S.Btn onClick={() => resetFilter()}>{t('newsFeed.reset')}</S.Btn>\n        <S.Btn onClick={() => applyFilter()} type=\"primary\">\n          {t('newsFeed.apply')}\n        </S.Btn>\n      </S.BtnWrapper>\n    </S.FilterWrapper>\n  );\n};\n\nexport const NewsFilter: React.FC<NewsFilterProps> = ({ news, newsTags, children }) => {\n  const [filterFields, setFilterFields] = useState<{\n    author: string;\n    title: string;\n    selectedTags: ITag[];\n    dates: [AppDate | null, AppDate | null];\n  }>({\n    author: '',\n    title: '',\n    selectedTags: [],\n    dates: [null, null],\n  });\n  const { author, title, selectedTags, dates } = filterFields;\n  const [filteredNews, setFilteredNews] = useState<Post[]>(news);\n  const [overlayVisible, setOverlayVisible] = useState<boolean>(false);\n  const { mobileOnly } = useResponsive();\n  const { t } = useTranslation();\n\n  const newsTagData = Object.values(newsTags || defaultTags);\n  const selectedTagsIds = useMemo(() => selectedTags.map((item) => item.id), [selectedTags]);\n\n  const onTagClick = useCallback(\n    (tag: ITag) => {\n      const isExist = selectedTagsIds.includes(tag.id);\n\n      if (isExist) {\n        setFilterFields({\n          ...filterFields,\n          selectedTags: selectedTags.filter((item) => item.id !== tag.id),\n        });\n      } else {\n        setFilterFields({\n          ...filterFields,\n          selectedTags: [...selectedTags, tag],\n        });\n      }\n    },\n    [selectedTags, selectedTagsIds, filterFields],\n  );\n\n  const filterNews = useCallback(\n    (isReset = false) => {\n      let updatedNews = [...news];\n      if ((author || title || dates[0] || selectedTags.length) && !isReset) {\n        updatedNews = news.filter((post) => {\n          const postAuthor = post.author.toLowerCase();\n          const enteredAuthor = author.toLowerCase();\n          const postTitle = post.title.toLowerCase();\n          const enteredTitle = title.toLowerCase();\n          const postTags = post.tags;\n          const postDate = Dates.getDate(post.date);\n\n          const fieldsValidators = [\n            new AuthorValidator(postAuthor, enteredAuthor),\n            new TitleValidator(postTitle, enteredTitle),\n            new DatesValidator(postDate, dates),\n            new TagsValidator(postTags, selectedTags),\n          ];\n\n          return fieldsValidators.map((validator) => validator.validate()).every((i) => i);\n        });\n      }\n      setFilteredNews(\n        updatedNews.sort((a, b) => {\n          return b.date - a.date;\n        }),\n      );\n    },\n    [news, author, title, dates, selectedTags],\n  );\n\n  useEffect(() => {\n    setFilteredNews(news);\n    filterNews(false);\n    // TODO AT-183\n    // eslint-disable-next-line\n  }, [news]);\n\n  const handleClickApply = useCallback(() => {\n    filterNews(false);\n\n    if (mobileOnly) {\n      setOverlayVisible(false);\n    }\n  }, [mobileOnly, filterNews]);\n\n  const handleClickReset = useCallback(() => {\n    setFilterFields({ author: '', title: '', dates: [null, null], selectedTags: [] });\n    filterNews(true);\n\n    if (mobileOnly) {\n      setOverlayVisible(false);\n    }\n  }, [filterNews, setFilterFields, mobileOnly]);\n\n  const updateFilteredField = (field: string, value: string | [AppDate | null, AppDate | null]) => {\n    setFilterFields({ ...filterFields, [field]: value });\n  };\n\n  return (\n    <>\n      <S.TitleWrapper>\n        {mobileOnly && (\n          <Dropdown\n            placement=\"bottomLeft\"\n            trigger={['click']}\n            visible={overlayVisible}\n            onVisibleChange={(visible) => setOverlayVisible(visible)}\n            overlay={\n              <Filter\n                author={author}\n                title={title}\n                newsTagData={newsTagData}\n                onTagClick={onTagClick}\n                selectedTagsIds={selectedTagsIds}\n                selectedTags={selectedTags}\n                dates={dates}\n                onApply={handleClickApply}\n                onReset={handleClickReset}\n                updateFilteredField={updateFilteredField}\n              />\n            }\n          >\n            <S.FilterButton>{t('newsFeed.filter')}</S.FilterButton>\n          </Dropdown>\n        )}\n      </S.TitleWrapper>\n\n      <S.ContentWrapper>\n        <S.NewsWrapper>{children({ filteredNews: filteredNews || news })}</S.NewsWrapper>\n\n        {!mobileOnly && (\n          <Filter\n            author={author}\n            title={title}\n            newsTagData={newsTagData}\n            onTagClick={onTagClick}\n            selectedTagsIds={selectedTagsIds}\n            selectedTags={selectedTags}\n            dates={dates}\n            onApply={handleClickApply}\n            onReset={handleClickReset}\n            updateFilteredField={updateFilteredField}\n          />\n        )}\n      </S.ContentWrapper>\n    </>\n  );\n};\n"]},"metadata":{},"sourceType":"module"}