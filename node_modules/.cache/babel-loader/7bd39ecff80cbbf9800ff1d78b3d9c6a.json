{"ast":null,"code":"import _defineProperty from\"/workspace/ant-design-react-template/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";import _objectSpread from\"/workspace/ant-design-react-template/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _slicedToArray from\"/workspace/ant-design-react-template/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useCallback,useMemo,useState}from'react';import{Col,Row}from'antd';import{useTranslation}from'react-i18next';import{BaseButtonsForm}from'@app/components/common/forms/BaseButtonsForm/BaseButtonsForm';import{TwoFactorOptions}from'@app/components/profile/profileCard/profileFormNav/nav/SecuritySettings/twoFactorAuth/TwoFactorOptions/TwoFactorOptions';import{TwoFactorSwitch}from'@app/components/profile/profileCard/profileFormNav/nav/SecuritySettings/twoFactorAuth/TwoFactorSwitch/TwoFactorSwitch';import{Button}from'@app/components/common/buttons/Button/Button';import{SecurityCodeForm}from'@app/components/auth/SecurityCodeForm/SecurityCodeForm';import{notificationController}from'@app/controllers/notificationController';import{setUser}from'@app/store/slices/userSlice';import{useAppDispatch,useAppSelector}from'@app/hooks/reduxHooks';import*as S from'./TwoFactorAuth.styles';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";export var TwoFactorAuth=function TwoFactorAuth(){var user=useAppSelector(function(state){return state.user.user;});var isNeedToShowVerifyBtn=useMemo(function(){return(user===null||user===void 0?void 0:user.email.name)&&!(user!==null&&user!==void 0&&user.email.verified)||(user===null||user===void 0?void 0:user.phone.number)&&!(user!==null&&user!==void 0&&user.phone.verified);},[user]);var _useState=useState(Boolean(isNeedToShowVerifyBtn)),_useState2=_slicedToArray(_useState,2),isFieldsChanged=_useState2[0],setFieldsChanged=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),isLoading=_useState4[0],setLoading=_useState4[1];var _useState5=useState(Boolean((user===null||user===void 0?void 0:user.email.verified)||(user===null||user===void 0?void 0:user.phone.verified))),_useState6=_slicedToArray(_useState5,2),isEnabled=_useState6[0],setEnabled=_useState6[1];var _useState7=useState('email'),_useState8=_slicedToArray(_useState7,2),selectedOption=_useState8[0],setSelectedOption=_useState8[1];var _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),isClickedVerify=_useState10[0],setClickedVerify=_useState10[1];var dispatch=useAppDispatch();var _useTranslation=useTranslation(),t=_useTranslation.t;var onClickVerify=function onClickVerify(){setClickedVerify(true);};var onVerify=useCallback(function(){if(user&&selectedOption){setLoading(false);setFieldsChanged(false);setClickedVerify(false);notificationController.success({message:t('common.success')});var newUser=_objectSpread(_objectSpread({},user),{},_defineProperty({},selectedOption,_objectSpread(_objectSpread({},user[selectedOption]),{},{verified:true})));dispatch(setUser(newUser));}},[dispatch,selectedOption,t,user]);return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(BaseButtonsForm,{name:\"twoFactorAuth\",requiredMark:\"optional\",isFieldsChanged:isFieldsChanged,onFieldsChange:function onFieldsChange(){return setFieldsChanged(true);},initialValues:{email:user===null||user===void 0?void 0:user.email.name,phone:user===null||user===void 0?void 0:user.phone.number},footer:isEnabled&&/*#__PURE__*/_jsx(Button,{type:\"link\",loading:isLoading,htmlType:\"submit\",children:t('profile.nav.securitySettings.verify')})||/*#__PURE__*/_jsx(\"span\",{}),onFinish:onClickVerify,children:/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsx(Col,{span:24,children:/*#__PURE__*/_jsx(TwoFactorSwitch,{isEnabled:isEnabled,setEnabled:setEnabled})}),isEnabled&&/*#__PURE__*/_jsx(Col,{span:24,children:/*#__PURE__*/_jsx(TwoFactorOptions,{selectedOption:selectedOption,setSelectedOption:setSelectedOption})})]})}),/*#__PURE__*/_jsx(S.AuthModal,{destroyOnClose:true,visible:isClickedVerify,footer:false,closable:false,onCancel:function onCancel(){return setClickedVerify(false);},children:/*#__PURE__*/_jsx(SecurityCodeForm,{onBack:function onBack(){return setClickedVerify(false);},onFinish:onVerify})})]});};","map":{"version":3,"names":["React","useCallback","useMemo","useState","Col","Row","useTranslation","BaseButtonsForm","TwoFactorOptions","TwoFactorSwitch","Button","SecurityCodeForm","notificationController","setUser","useAppDispatch","useAppSelector","S","TwoFactorAuth","user","state","isNeedToShowVerifyBtn","email","name","verified","phone","number","Boolean","isFieldsChanged","setFieldsChanged","isLoading","setLoading","isEnabled","setEnabled","selectedOption","setSelectedOption","isClickedVerify","setClickedVerify","dispatch","t","onClickVerify","onVerify","success","message","newUser"],"sources":["/workspace/ant-design-react-template/src/components/profile/profileCard/profileFormNav/nav/SecuritySettings/twoFactorAuth/TwoFactorAuth.tsx"],"sourcesContent":["import React, { useCallback, useMemo, useState } from 'react';\nimport { Col, Row } from 'antd';\nimport { useTranslation } from 'react-i18next';\nimport { BaseButtonsForm } from '@app/components/common/forms/BaseButtonsForm/BaseButtonsForm';\nimport { TwoFactorOptions } from '@app/components/profile/profileCard/profileFormNav/nav/SecuritySettings/twoFactorAuth/TwoFactorOptions/TwoFactorOptions';\nimport { TwoFactorSwitch } from '@app/components/profile/profileCard/profileFormNav/nav/SecuritySettings/twoFactorAuth/TwoFactorSwitch/TwoFactorSwitch';\nimport { Button } from '@app/components/common/buttons/Button/Button';\nimport { SecurityCodeForm } from '@app/components/auth/SecurityCodeForm/SecurityCodeForm';\nimport { notificationController } from '@app/controllers/notificationController';\nimport { setUser } from '@app/store/slices/userSlice';\nimport { useAppDispatch, useAppSelector } from '@app/hooks/reduxHooks';\nimport { TwoFactorAuthOption } from '@app/interfaces/interfaces';\nimport * as S from './TwoFactorAuth.styles';\n\nexport interface CurrentOption {\n  value: 'phone' | 'email';\n  isVerified: boolean;\n}\n\nexport type TwoFactorAuthOptionState = TwoFactorAuthOption | null;\n\nexport const TwoFactorAuth: React.FC = () => {\n  const user = useAppSelector((state) => state.user.user);\n\n  const isNeedToShowVerifyBtn = useMemo(\n    () => (user?.email.name && !user?.email.verified) || (user?.phone.number && !user?.phone.verified),\n    [user],\n  );\n\n  const [isFieldsChanged, setFieldsChanged] = useState(Boolean(isNeedToShowVerifyBtn));\n  const [isLoading, setLoading] = useState(false);\n\n  const [isEnabled, setEnabled] = useState(Boolean(user?.email.verified || user?.phone.verified));\n  const [selectedOption, setSelectedOption] = useState<TwoFactorAuthOptionState>('email');\n  const [isClickedVerify, setClickedVerify] = useState(false);\n\n  const dispatch = useAppDispatch();\n\n  const { t } = useTranslation();\n\n  const onClickVerify = () => {\n    setClickedVerify(true);\n  };\n\n  const onVerify = useCallback(() => {\n    if (user && selectedOption) {\n      setLoading(false);\n      setFieldsChanged(false);\n      setClickedVerify(false);\n      notificationController.success({ message: t('common.success') });\n\n      const newUser = { ...user, [selectedOption]: { ...user[selectedOption], verified: true } };\n\n      dispatch(setUser(newUser));\n    }\n  }, [dispatch, selectedOption, t, user]);\n\n  return (\n    <>\n      <BaseButtonsForm\n        name=\"twoFactorAuth\"\n        requiredMark=\"optional\"\n        isFieldsChanged={isFieldsChanged}\n        onFieldsChange={() => setFieldsChanged(true)}\n        initialValues={{\n          email: user?.email.name,\n          phone: user?.phone.number,\n        }}\n        footer={\n          (isEnabled && (\n            <Button type=\"link\" loading={isLoading} htmlType=\"submit\">\n              {t('profile.nav.securitySettings.verify')}\n            </Button>\n          )) || <span />\n        }\n        onFinish={onClickVerify}\n      >\n        <Row>\n          <Col span={24}>\n            <TwoFactorSwitch isEnabled={isEnabled} setEnabled={setEnabled} />\n          </Col>\n\n          {isEnabled && (\n            <Col span={24}>\n              <TwoFactorOptions selectedOption={selectedOption} setSelectedOption={setSelectedOption} />\n            </Col>\n          )}\n        </Row>\n      </BaseButtonsForm>\n      <S.AuthModal\n        destroyOnClose\n        visible={isClickedVerify}\n        footer={false}\n        closable={false}\n        onCancel={() => setClickedVerify(false)}\n      >\n        <SecurityCodeForm onBack={() => setClickedVerify(false)} onFinish={onVerify} />\n      </S.AuthModal>\n    </>\n  );\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}