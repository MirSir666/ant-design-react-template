{"ast":null,"code":"import _defineProperty from \"/workspace/ant-design-react-template/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";\nimport _objectSpread from \"/workspace/ant-design-react-template/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";\nimport _slicedToArray from \"/workspace/ant-design-react-template/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";\nvar _jsxFileName = \"/workspace/ant-design-react-template/src/components/profile/profileCard/profileFormNav/nav/SecuritySettings/twoFactorAuth/TwoFactorAuth.tsx\",\n  _this = this,\n  _s = $RefreshSig$();\nimport React, { useCallback, useMemo, useState } from 'react';\nimport { Col, Row } from 'antd';\nimport { useTranslation } from 'react-i18next';\nimport { BaseButtonsForm } from '@app/components/common/forms/BaseButtonsForm/BaseButtonsForm';\nimport { TwoFactorOptions } from '@app/components/profile/profileCard/profileFormNav/nav/SecuritySettings/twoFactorAuth/TwoFactorOptions/TwoFactorOptions';\nimport { TwoFactorSwitch } from '@app/components/profile/profileCard/profileFormNav/nav/SecuritySettings/twoFactorAuth/TwoFactorSwitch/TwoFactorSwitch';\nimport { Button } from '@app/components/common/buttons/Button/Button';\nimport { SecurityCodeForm } from '@app/components/auth/SecurityCodeForm/SecurityCodeForm';\nimport { notificationController } from '@app/controllers/notificationController';\nimport { setUser } from '@app/store/slices/userSlice';\nimport { useAppDispatch, useAppSelector } from '@app/hooks/reduxHooks';\nimport * as S from './TwoFactorAuth.styles';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nexport var TwoFactorAuth = function TwoFactorAuth() {\n  _s();\n  var user = useAppSelector(function (state) {\n    return state.user.user;\n  });\n  var isNeedToShowVerifyBtn = useMemo(function () {\n    return (user === null || user === void 0 ? void 0 : user.email.name) && !(user !== null && user !== void 0 && user.email.verified) || (user === null || user === void 0 ? void 0 : user.phone.number) && !(user !== null && user !== void 0 && user.phone.verified);\n  }, [user]);\n  var _useState = useState(Boolean(isNeedToShowVerifyBtn)),\n    _useState2 = _slicedToArray(_useState, 2),\n    isFieldsChanged = _useState2[0],\n    setFieldsChanged = _useState2[1];\n  var _useState3 = useState(false),\n    _useState4 = _slicedToArray(_useState3, 2),\n    isLoading = _useState4[0],\n    setLoading = _useState4[1];\n  var _useState5 = useState(Boolean((user === null || user === void 0 ? void 0 : user.email.verified) || (user === null || user === void 0 ? void 0 : user.phone.verified))),\n    _useState6 = _slicedToArray(_useState5, 2),\n    isEnabled = _useState6[0],\n    setEnabled = _useState6[1];\n  var _useState7 = useState('email'),\n    _useState8 = _slicedToArray(_useState7, 2),\n    selectedOption = _useState8[0],\n    setSelectedOption = _useState8[1];\n  var _useState9 = useState(false),\n    _useState10 = _slicedToArray(_useState9, 2),\n    isClickedVerify = _useState10[0],\n    setClickedVerify = _useState10[1];\n  var dispatch = useAppDispatch();\n  var _useTranslation = useTranslation(),\n    t = _useTranslation.t;\n  var onClickVerify = function onClickVerify() {\n    setClickedVerify(true);\n  };\n  var onVerify = useCallback(function () {\n    if (user && selectedOption) {\n      setLoading(false);\n      setFieldsChanged(false);\n      setClickedVerify(false);\n      notificationController.success({\n        message: t('common.success')\n      });\n      var newUser = _objectSpread(_objectSpread({}, user), {}, _defineProperty({}, selectedOption, _objectSpread(_objectSpread({}, user[selectedOption]), {}, {\n        verified: true\n      })));\n      dispatch(setUser(newUser));\n    }\n  }, [dispatch, selectedOption, t, user]);\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(BaseButtonsForm, {\n      name: \"twoFactorAuth\",\n      requiredMark: \"optional\",\n      isFieldsChanged: isFieldsChanged,\n      onFieldsChange: function onFieldsChange() {\n        return setFieldsChanged(true);\n      },\n      initialValues: {\n        email: user === null || user === void 0 ? void 0 : user.email.name,\n        phone: user === null || user === void 0 ? void 0 : user.phone.number\n      },\n      footer: isEnabled && /*#__PURE__*/_jsxDEV(Button, {\n        type: \"link\",\n        loading: isLoading,\n        htmlType: \"submit\",\n        children: t('profile.nav.securitySettings.verify')\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 71,\n        columnNumber: 13\n      }, _this) || /*#__PURE__*/_jsxDEV(\"span\", {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 74,\n        columnNumber: 17\n      }, _this),\n      onFinish: onClickVerify,\n      children: /*#__PURE__*/_jsxDEV(Row, {\n        children: [/*#__PURE__*/_jsxDEV(Col, {\n          span: 24,\n          children: /*#__PURE__*/_jsxDEV(TwoFactorSwitch, {\n            isEnabled: isEnabled,\n            setEnabled: setEnabled\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 80,\n            columnNumber: 13\n          }, _this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 79,\n          columnNumber: 11\n        }, _this), isEnabled && /*#__PURE__*/_jsxDEV(Col, {\n          span: 24,\n          children: /*#__PURE__*/_jsxDEV(TwoFactorOptions, {\n            selectedOption: selectedOption,\n            setSelectedOption: setSelectedOption\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 85,\n            columnNumber: 15\n          }, _this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 84,\n          columnNumber: 13\n        }, _this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 78,\n        columnNumber: 9\n      }, _this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 60,\n      columnNumber: 7\n    }, _this), /*#__PURE__*/_jsxDEV(S.AuthModal, {\n      destroyOnClose: true,\n      visible: isClickedVerify,\n      footer: false,\n      closable: false,\n      onCancel: function onCancel() {\n        return setClickedVerify(false);\n      },\n      children: /*#__PURE__*/_jsxDEV(SecurityCodeForm, {\n        onBack: function onBack() {\n          return setClickedVerify(false);\n        },\n        onFinish: onVerify\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 97,\n        columnNumber: 9\n      }, _this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 90,\n      columnNumber: 7\n    }, _this)]\n  }, void 0, true);\n};\n_s(TwoFactorAuth, \"IezeX7mgArfGNZNlGPjl74satEc=\", false, function () {\n  return [useAppSelector, useAppDispatch, useTranslation];\n});\n_c = TwoFactorAuth;\nvar _c;\n$RefreshReg$(_c, \"TwoFactorAuth\");","map":{"version":3,"names":["React","useCallback","useMemo","useState","Col","Row","useTranslation","BaseButtonsForm","TwoFactorOptions","TwoFactorSwitch","Button","SecurityCodeForm","notificationController","setUser","useAppDispatch","useAppSelector","S","TwoFactorAuth","user","state","isNeedToShowVerifyBtn","email","name","verified","phone","number","Boolean","isFieldsChanged","setFieldsChanged","isLoading","setLoading","isEnabled","setEnabled","selectedOption","setSelectedOption","isClickedVerify","setClickedVerify","dispatch","t","onClickVerify","onVerify","success","message","newUser"],"sources":["/workspace/ant-design-react-template/src/components/profile/profileCard/profileFormNav/nav/SecuritySettings/twoFactorAuth/TwoFactorAuth.tsx"],"sourcesContent":["import React, { useCallback, useMemo, useState } from 'react';\nimport { Col, Row } from 'antd';\nimport { useTranslation } from 'react-i18next';\nimport { BaseButtonsForm } from '@app/components/common/forms/BaseButtonsForm/BaseButtonsForm';\nimport { TwoFactorOptions } from '@app/components/profile/profileCard/profileFormNav/nav/SecuritySettings/twoFactorAuth/TwoFactorOptions/TwoFactorOptions';\nimport { TwoFactorSwitch } from '@app/components/profile/profileCard/profileFormNav/nav/SecuritySettings/twoFactorAuth/TwoFactorSwitch/TwoFactorSwitch';\nimport { Button } from '@app/components/common/buttons/Button/Button';\nimport { SecurityCodeForm } from '@app/components/auth/SecurityCodeForm/SecurityCodeForm';\nimport { notificationController } from '@app/controllers/notificationController';\nimport { setUser } from '@app/store/slices/userSlice';\nimport { useAppDispatch, useAppSelector } from '@app/hooks/reduxHooks';\nimport { TwoFactorAuthOption } from '@app/interfaces/interfaces';\nimport * as S from './TwoFactorAuth.styles';\n\nexport interface CurrentOption {\n  value: 'phone' | 'email';\n  isVerified: boolean;\n}\n\nexport type TwoFactorAuthOptionState = TwoFactorAuthOption | null;\n\nexport const TwoFactorAuth: React.FC = () => {\n  const user = useAppSelector((state) => state.user.user);\n\n  const isNeedToShowVerifyBtn = useMemo(\n    () => (user?.email.name && !user?.email.verified) || (user?.phone.number && !user?.phone.verified),\n    [user],\n  );\n\n  const [isFieldsChanged, setFieldsChanged] = useState(Boolean(isNeedToShowVerifyBtn));\n  const [isLoading, setLoading] = useState(false);\n\n  const [isEnabled, setEnabled] = useState(Boolean(user?.email.verified || user?.phone.verified));\n  const [selectedOption, setSelectedOption] = useState<TwoFactorAuthOptionState>('email');\n  const [isClickedVerify, setClickedVerify] = useState(false);\n\n  const dispatch = useAppDispatch();\n\n  const { t } = useTranslation();\n\n  const onClickVerify = () => {\n    setClickedVerify(true);\n  };\n\n  const onVerify = useCallback(() => {\n    if (user && selectedOption) {\n      setLoading(false);\n      setFieldsChanged(false);\n      setClickedVerify(false);\n      notificationController.success({ message: t('common.success') });\n\n      const newUser = { ...user, [selectedOption]: { ...user[selectedOption], verified: true } };\n\n      dispatch(setUser(newUser));\n    }\n  }, [dispatch, selectedOption, t, user]);\n\n  return (\n    <>\n      <BaseButtonsForm\n        name=\"twoFactorAuth\"\n        requiredMark=\"optional\"\n        isFieldsChanged={isFieldsChanged}\n        onFieldsChange={() => setFieldsChanged(true)}\n        initialValues={{\n          email: user?.email.name,\n          phone: user?.phone.number,\n        }}\n        footer={\n          (isEnabled && (\n            <Button type=\"link\" loading={isLoading} htmlType=\"submit\">\n              {t('profile.nav.securitySettings.verify')}\n            </Button>\n          )) || <span />\n        }\n        onFinish={onClickVerify}\n      >\n        <Row>\n          <Col span={24}>\n            <TwoFactorSwitch isEnabled={isEnabled} setEnabled={setEnabled} />\n          </Col>\n\n          {isEnabled && (\n            <Col span={24}>\n              <TwoFactorOptions selectedOption={selectedOption} setSelectedOption={setSelectedOption} />\n            </Col>\n          )}\n        </Row>\n      </BaseButtonsForm>\n      <S.AuthModal\n        destroyOnClose\n        visible={isClickedVerify}\n        footer={false}\n        closable={false}\n        onCancel={() => setClickedVerify(false)}\n      >\n        <SecurityCodeForm onBack={() => setClickedVerify(false)} onFinish={onVerify} />\n      </S.AuthModal>\n    </>\n  );\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}