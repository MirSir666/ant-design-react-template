{"ast":null,"code":"import _regeneratorRuntime from\"/workspace/ant-design-react-template/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _toConsumableArray from\"/workspace/ant-design-react-template/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _asyncToGenerator from\"/workspace/ant-design-react-template/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _objectSpread from\"/workspace/ant-design-react-template/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _slicedToArray from\"/workspace/ant-design-react-template/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useState,useEffect,useCallback}from'react';import{Popconfirm,Form,Space}from'antd';import{Table}from'components/common/Table/Table';import{getEditableTableData}from'api/table.api';import{EditableCell}from'./EditableCell';import{Button}from'components/common/buttons/Button/Button';import{useTranslation}from'react-i18next';import{useMounted}from'@app/hooks/useMounted';import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var initialPagination={current:1,pageSize:4};export var EditableTable=function EditableTable(){var _Form$useForm=Form.useForm(),_Form$useForm2=_slicedToArray(_Form$useForm,1),form=_Form$useForm2[0];var _useState=useState({data:[],pagination:initialPagination,loading:false}),_useState2=_slicedToArray(_useState,2),tableData=_useState2[0],setTableData=_useState2[1];var _useState3=useState(0),_useState4=_slicedToArray(_useState3,2),editingKey=_useState4[0],setEditingKey=_useState4[1];var _useTranslation=useTranslation(),t=_useTranslation.t;var _useMounted=useMounted(),isMounted=_useMounted.isMounted;var fetch=useCallback(function(pagination){setTableData(function(tableData){return _objectSpread(_objectSpread({},tableData),{},{loading:true});});getEditableTableData(pagination).then(function(res){if(isMounted.current){setTableData({data:res.data,pagination:res.pagination,loading:false});}});},[isMounted]);useEffect(function(){fetch(initialPagination);},[fetch]);var handleTableChange=function handleTableChange(pagination){fetch(pagination);cancel();};var isEditing=function isEditing(record){return record.key===editingKey;};var edit=function edit(record){form.setFieldsValue(_objectSpread({name:'',age:'',address:''},record));setEditingKey(record.key);};var cancel=function cancel(){setEditingKey(0);};var save=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(key){var row,newData,index,item;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return form.validateFields();case 3:row=_context.sent;newData=_toConsumableArray(tableData.data);index=newData.findIndex(function(item){return key===item.key;});if(index>-1){item=newData[index];newData.splice(index,1,_objectSpread(_objectSpread({},item),row));}else{newData.push(row);}setTableData(_objectSpread(_objectSpread({},tableData),{},{data:newData}));setEditingKey(0);_context.next=14;break;case 11:_context.prev=11;_context.t0=_context[\"catch\"](0);console.log('Validate Failed:',_context.t0);case 14:case\"end\":return _context.stop();}}},_callee,null,[[0,11]]);}));return function save(_x){return _ref.apply(this,arguments);};}();var handleDeleteRow=function handleDeleteRow(rowId){setTableData(_objectSpread(_objectSpread({},tableData),{},{data:tableData.data.filter(function(item){return item.key!==rowId;})}));};var columns=[{title:t('common.name'),dataIndex:'name',width:'25%',editable:true},{title:t('common.age'),dataIndex:'age',width:'15%',editable:true},{title:t('common.address'),dataIndex:'address',width:'30%',editable:true},{title:t('tables.actions'),dataIndex:'actions',width:'15%',render:function render(text,record){var editable=isEditing(record);return/*#__PURE__*/_jsx(Space,{children:editable?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Button,{type:\"primary\",onClick:function onClick(){return save(record.key);},children:t('common.save')}),/*#__PURE__*/_jsx(Popconfirm,{title:t('tables.cancelInfo'),onConfirm:cancel,children:/*#__PURE__*/_jsx(Button,{type:\"ghost\",children:t('common.cancel')})})]}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Button,{type:\"ghost\",disabled:editingKey!==0,onClick:function onClick(){return edit(record);},children:t('common.edit')}),/*#__PURE__*/_jsx(Button,{type:\"default\",danger:true,onClick:function onClick(){return handleDeleteRow(record.key);},children:t('tables.delete')})]})});}}];var mergedColumns=columns.map(function(col){if(!col.editable){return col;}return _objectSpread(_objectSpread({},col),{},{onCell:function onCell(record){return{record:record,inputType:col.dataIndex==='age'?'number':'text',dataIndex:col.dataIndex,title:col.title,editing:isEditing(record)};}});});return/*#__PURE__*/_jsx(Form,{form:form,component:false,children:/*#__PURE__*/_jsx(Table,{components:{body:{cell:EditableCell}},bordered:true,dataSource:tableData.data,columns:mergedColumns,rowClassName:\"editable-row\",pagination:_objectSpread(_objectSpread({},tableData.pagination),{},{onChange:cancel}),onChange:handleTableChange,loading:tableData.loading,scroll:{x:800}})});};","map":{"version":3,"names":["React","useState","useEffect","useCallback","Popconfirm","Form","Space","Table","getEditableTableData","EditableCell","Button","useTranslation","useMounted","initialPagination","current","pageSize","EditableTable","useForm","form","data","pagination","loading","tableData","setTableData","editingKey","setEditingKey","t","isMounted","fetch","then","res","handleTableChange","cancel","isEditing","record","key","edit","setFieldsValue","name","age","address","save","validateFields","row","newData","index","findIndex","item","splice","push","console","log","handleDeleteRow","rowId","filter","columns","title","dataIndex","width","editable","render","text","mergedColumns","map","col","onCell","inputType","editing","body","cell","onChange","x"],"sources":["/workspace/ant-design-react-template/src/components/tables/editableTable/EditableTable.tsx"],"sourcesContent":["import React, { useState, useEffect, useCallback } from 'react';\nimport { Popconfirm, Form, TablePaginationConfig, Space } from 'antd';\nimport { Table } from 'components/common/Table/Table';\nimport { getEditableTableData, BasicTableRow, Pagination } from 'api/table.api';\nimport { EditableCell } from './EditableCell';\nimport { Button } from 'components/common/buttons/Button/Button';\nimport { useTranslation } from 'react-i18next';\nimport { useMounted } from '@app/hooks/useMounted';\n\nconst initialPagination: Pagination = {\n  current: 1,\n  pageSize: 4,\n};\n\nexport const EditableTable: React.FC = () => {\n  const [form] = Form.useForm();\n  const [tableData, setTableData] = useState<{ data: BasicTableRow[]; pagination: Pagination; loading: boolean }>({\n    data: [],\n    pagination: initialPagination,\n    loading: false,\n  });\n  const [editingKey, setEditingKey] = useState(0);\n  const { t } = useTranslation();\n  const { isMounted } = useMounted();\n\n  const fetch = useCallback(\n    (pagination: Pagination) => {\n      setTableData((tableData) => ({ ...tableData, loading: true }));\n      getEditableTableData(pagination).then((res) => {\n        if (isMounted.current) {\n          setTableData({ data: res.data, pagination: res.pagination, loading: false });\n        }\n      });\n    },\n    [isMounted],\n  );\n\n  useEffect(() => {\n    fetch(initialPagination);\n  }, [fetch]);\n\n  const handleTableChange = (pagination: TablePaginationConfig) => {\n    fetch(pagination);\n    cancel();\n  };\n\n  const isEditing = (record: BasicTableRow) => record.key === editingKey;\n\n  const edit = (record: Partial<BasicTableRow> & { key: React.Key }) => {\n    form.setFieldsValue({ name: '', age: '', address: '', ...record });\n    setEditingKey(record.key);\n  };\n\n  const cancel = () => {\n    setEditingKey(0);\n  };\n\n  const save = async (key: React.Key) => {\n    try {\n      const row = (await form.validateFields()) as BasicTableRow;\n\n      const newData = [...tableData.data];\n      const index = newData.findIndex((item) => key === item.key);\n      if (index > -1) {\n        const item = newData[index];\n        newData.splice(index, 1, {\n          ...item,\n          ...row,\n        });\n      } else {\n        newData.push(row);\n      }\n      setTableData({ ...tableData, data: newData });\n      setEditingKey(0);\n    } catch (errInfo) {\n      console.log('Validate Failed:', errInfo);\n    }\n  };\n\n  const handleDeleteRow = (rowId: number) => {\n    setTableData({ ...tableData, data: tableData.data.filter((item) => item.key !== rowId) });\n  };\n\n  const columns = [\n    {\n      title: t('common.name'),\n      dataIndex: 'name',\n      width: '25%',\n      editable: true,\n    },\n    {\n      title: t('common.age'),\n      dataIndex: 'age',\n      width: '15%',\n      editable: true,\n    },\n    {\n      title: t('common.address'),\n      dataIndex: 'address',\n      width: '30%',\n      editable: true,\n    },\n    {\n      title: t('tables.actions'),\n      dataIndex: 'actions',\n      width: '15%',\n      render: (text: string, record: BasicTableRow) => {\n        const editable = isEditing(record);\n        return (\n          <Space>\n            {editable ? (\n              <>\n                <Button type=\"primary\" onClick={() => save(record.key)}>\n                  {t('common.save')}\n                </Button>\n                <Popconfirm title={t('tables.cancelInfo')} onConfirm={cancel}>\n                  <Button type=\"ghost\">{t('common.cancel')}</Button>\n                </Popconfirm>\n              </>\n            ) : (\n              <>\n                <Button type=\"ghost\" disabled={editingKey !== 0} onClick={() => edit(record)}>\n                  {t('common.edit')}\n                </Button>\n                <Button type=\"default\" danger onClick={() => handleDeleteRow(record.key)}>\n                  {t('tables.delete')}\n                </Button>\n              </>\n            )}\n          </Space>\n        );\n      },\n    },\n  ];\n\n  const mergedColumns = columns.map((col) => {\n    if (!col.editable) {\n      return col;\n    }\n    return {\n      ...col,\n      onCell: (record: BasicTableRow) => ({\n        record,\n        inputType: col.dataIndex === 'age' ? 'number' : 'text',\n        dataIndex: col.dataIndex,\n        title: col.title,\n        editing: isEditing(record),\n      }),\n    };\n  });\n\n  return (\n    <Form form={form} component={false}>\n      <Table\n        components={{\n          body: {\n            cell: EditableCell,\n          },\n        }}\n        bordered\n        dataSource={tableData.data}\n        columns={mergedColumns}\n        rowClassName=\"editable-row\"\n        pagination={{\n          ...tableData.pagination,\n          onChange: cancel,\n        }}\n        onChange={handleTableChange}\n        loading={tableData.loading}\n        scroll={{ x: 800 }}\n      />\n    </Form>\n  );\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}