{"ast":null,"code":"import _toConsumableArray from\"/workspace/lightence-ant-design-react-template/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _asyncToGenerator from\"/workspace/lightence-ant-design-react-template/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _objectSpread from\"/workspace/lightence-ant-design-react-template/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _slicedToArray from\"/workspace/lightence-ant-design-react-template/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/workspace/lightence-ant-design-react-template/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator/index.js\";import React,{useState,useEffect,useCallback}from'react';import{Popconfirm,Form,Space}from'antd';import{Table}from'components/common/Table/Table';import{getEditableTableData}from'api/table.api';import{EditableCell}from'./EditableCell';import{Button}from'components/common/buttons/Button/Button';import{useTranslation}from'react-i18next';import{useMounted}from'@app/hooks/useMounted';import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var initialPagination={current:1,pageSize:4};export var EditableTable=function EditableTable(){var _Form$useForm=Form.useForm(),_Form$useForm2=_slicedToArray(_Form$useForm,1),form=_Form$useForm2[0];var _useState=useState({data:[],pagination:initialPagination,loading:false}),_useState2=_slicedToArray(_useState,2),tableData=_useState2[0],setTableData=_useState2[1];var _useState3=useState(0),_useState4=_slicedToArray(_useState3,2),editingKey=_useState4[0],setEditingKey=_useState4[1];var _useTranslation=useTranslation(),t=_useTranslation.t;var _useMounted=useMounted(),isMounted=_useMounted.isMounted;var fetch=useCallback(function(pagination){setTableData(function(tableData){return _objectSpread(_objectSpread({},tableData),{},{loading:true});});getEditableTableData(pagination).then(function(res){if(isMounted.current){setTableData({data:res.data,pagination:res.pagination,loading:false});}});},[isMounted]);useEffect(function(){fetch(initialPagination);},[fetch]);var handleTableChange=function handleTableChange(pagination){fetch(pagination);cancel();};var isEditing=function isEditing(record){return record.key===editingKey;};var edit=function edit(record){form.setFieldsValue(_objectSpread({name:'',age:'',address:''},record));setEditingKey(record.key);};var cancel=function cancel(){setEditingKey(0);};var save=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(key){var row,newData,index,item;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return form.validateFields();case 3:row=_context.sent;newData=_toConsumableArray(tableData.data);index=newData.findIndex(function(item){return key===item.key;});if(index>-1){item=newData[index];newData.splice(index,1,_objectSpread(_objectSpread({},item),row));}else{newData.push(row);}setTableData(_objectSpread(_objectSpread({},tableData),{},{data:newData}));setEditingKey(0);_context.next=14;break;case 11:_context.prev=11;_context.t0=_context[\"catch\"](0);console.log('Validate Failed:',_context.t0);case 14:case\"end\":return _context.stop();}}},_callee,null,[[0,11]]);}));return function save(_x){return _ref.apply(this,arguments);};}();var handleDeleteRow=function handleDeleteRow(rowId){setTableData(_objectSpread(_objectSpread({},tableData),{},{data:tableData.data.filter(function(item){return item.key!==rowId;})}));};var columns=[{title:t('common.name'),dataIndex:'name',width:'25%',editable:true},{title:t('common.age'),dataIndex:'age',width:'15%',editable:true},{title:t('common.address'),dataIndex:'address',width:'30%',editable:true},{title:t('tables.actions'),dataIndex:'actions',width:'15%',render:function render(text,record){var editable=isEditing(record);return/*#__PURE__*/_jsx(Space,{children:editable?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Button,{type:\"primary\",onClick:function onClick(){return save(record.key);},children:t('common.save')}),/*#__PURE__*/_jsx(Popconfirm,{title:t('tables.cancelInfo'),onConfirm:cancel,children:/*#__PURE__*/_jsx(Button,{type:\"ghost\",children:t('common.cancel')})})]}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Button,{type:\"ghost\",disabled:editingKey!==0,onClick:function onClick(){return edit(record);},children:t('common.edit')}),/*#__PURE__*/_jsx(Button,{type:\"default\",danger:true,onClick:function onClick(){return handleDeleteRow(record.key);},children:t('tables.delete')})]})});}}];var mergedColumns=columns.map(function(col){if(!col.editable){return col;}return _objectSpread(_objectSpread({},col),{},{onCell:function onCell(record){return{record:record,inputType:col.dataIndex==='age'?'number':'text',dataIndex:col.dataIndex,title:col.title,editing:isEditing(record)};}});});return/*#__PURE__*/_jsx(Form,{form:form,component:false,children:/*#__PURE__*/_jsx(Table,{components:{body:{cell:EditableCell}},bordered:true,dataSource:tableData.data,columns:mergedColumns,rowClassName:\"editable-row\",pagination:_objectSpread(_objectSpread({},tableData.pagination),{},{onChange:cancel}),onChange:handleTableChange,loading:tableData.loading,scroll:{x:800}})});};","map":{"version":3,"sources":["/workspace/lightence-ant-design-react-template/src/components/tables/editableTable/EditableTable.tsx"],"names":["React","useState","useEffect","useCallback","Popconfirm","Form","Space","Table","getEditableTableData","EditableCell","Button","useTranslation","useMounted","initialPagination","current","pageSize","EditableTable","useForm","form","data","pagination","loading","tableData","setTableData","editingKey","setEditingKey","t","isMounted","fetch","then","res","handleTableChange","cancel","isEditing","record","key","edit","setFieldsValue","name","age","address","save","validateFields","row","newData","index","findIndex","item","splice","push","console","log","handleDeleteRow","rowId","filter","columns","title","dataIndex","width","editable","render","text","mergedColumns","map","col","onCell","inputType","editing","body","cell","onChange","x"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useCallback } from 'react';\nimport { Popconfirm, Form, TablePaginationConfig, Space } from 'antd';\nimport { Table } from 'components/common/Table/Table';\nimport { getEditableTableData, BasicTableRow, Pagination } from 'api/table.api';\nimport { EditableCell } from './EditableCell';\nimport { Button } from 'components/common/buttons/Button/Button';\nimport { useTranslation } from 'react-i18next';\nimport { useMounted } from '@app/hooks/useMounted';\n\nconst initialPagination: Pagination = {\n  current: 1,\n  pageSize: 4,\n};\n\nexport const EditableTable: React.FC = () => {\n  const [form] = Form.useForm();\n  const [tableData, setTableData] = useState<{ data: BasicTableRow[]; pagination: Pagination; loading: boolean }>({\n    data: [],\n    pagination: initialPagination,\n    loading: false,\n  });\n  const [editingKey, setEditingKey] = useState(0);\n  const { t } = useTranslation();\n  const { isMounted } = useMounted();\n\n  const fetch = useCallback(\n    (pagination: Pagination) => {\n      setTableData((tableData) => ({ ...tableData, loading: true }));\n      getEditableTableData(pagination).then((res) => {\n        if (isMounted.current) {\n          setTableData({ data: res.data, pagination: res.pagination, loading: false });\n        }\n      });\n    },\n    [isMounted],\n  );\n\n  useEffect(() => {\n    fetch(initialPagination);\n  }, [fetch]);\n\n  const handleTableChange = (pagination: TablePaginationConfig) => {\n    fetch(pagination);\n    cancel();\n  };\n\n  const isEditing = (record: BasicTableRow) => record.key === editingKey;\n\n  const edit = (record: Partial<BasicTableRow> & { key: React.Key }) => {\n    form.setFieldsValue({ name: '', age: '', address: '', ...record });\n    setEditingKey(record.key);\n  };\n\n  const cancel = () => {\n    setEditingKey(0);\n  };\n\n  const save = async (key: React.Key) => {\n    try {\n      const row = (await form.validateFields()) as BasicTableRow;\n\n      const newData = [...tableData.data];\n      const index = newData.findIndex((item) => key === item.key);\n      if (index > -1) {\n        const item = newData[index];\n        newData.splice(index, 1, {\n          ...item,\n          ...row,\n        });\n      } else {\n        newData.push(row);\n      }\n      setTableData({ ...tableData, data: newData });\n      setEditingKey(0);\n    } catch (errInfo) {\n      console.log('Validate Failed:', errInfo);\n    }\n  };\n\n  const handleDeleteRow = (rowId: number) => {\n    setTableData({ ...tableData, data: tableData.data.filter((item) => item.key !== rowId) });\n  };\n\n  const columns = [\n    {\n      title: t('common.name'),\n      dataIndex: 'name',\n      width: '25%',\n      editable: true,\n    },\n    {\n      title: t('common.age'),\n      dataIndex: 'age',\n      width: '15%',\n      editable: true,\n    },\n    {\n      title: t('common.address'),\n      dataIndex: 'address',\n      width: '30%',\n      editable: true,\n    },\n    {\n      title: t('tables.actions'),\n      dataIndex: 'actions',\n      width: '15%',\n      render: (text: string, record: BasicTableRow) => {\n        const editable = isEditing(record);\n        return (\n          <Space>\n            {editable ? (\n              <>\n                <Button type=\"primary\" onClick={() => save(record.key)}>\n                  {t('common.save')}\n                </Button>\n                <Popconfirm title={t('tables.cancelInfo')} onConfirm={cancel}>\n                  <Button type=\"ghost\">{t('common.cancel')}</Button>\n                </Popconfirm>\n              </>\n            ) : (\n              <>\n                <Button type=\"ghost\" disabled={editingKey !== 0} onClick={() => edit(record)}>\n                  {t('common.edit')}\n                </Button>\n                <Button type=\"default\" danger onClick={() => handleDeleteRow(record.key)}>\n                  {t('tables.delete')}\n                </Button>\n              </>\n            )}\n          </Space>\n        );\n      },\n    },\n  ];\n\n  const mergedColumns = columns.map((col) => {\n    if (!col.editable) {\n      return col;\n    }\n    return {\n      ...col,\n      onCell: (record: BasicTableRow) => ({\n        record,\n        inputType: col.dataIndex === 'age' ? 'number' : 'text',\n        dataIndex: col.dataIndex,\n        title: col.title,\n        editing: isEditing(record),\n      }),\n    };\n  });\n\n  return (\n    <Form form={form} component={false}>\n      <Table\n        components={{\n          body: {\n            cell: EditableCell,\n          },\n        }}\n        bordered\n        dataSource={tableData.data}\n        columns={mergedColumns}\n        rowClassName=\"editable-row\"\n        pagination={{\n          ...tableData.pagination,\n          onChange: cancel,\n        }}\n        onChange={handleTableChange}\n        loading={tableData.loading}\n        scroll={{ x: 800 }}\n      />\n    </Form>\n  );\n};\n"]},"metadata":{},"sourceType":"module"}